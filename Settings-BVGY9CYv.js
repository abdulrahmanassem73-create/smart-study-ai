import{j as e,Y as E,Z as I,$ as R,a0 as B,a1 as H,a2 as O,a3 as L,a4 as U,a5 as q,a6 as M,a7 as Q,r as l,n as V,a8 as W,D as Y}from"./vendor-ui-ARy-o6ek.js";import{d as n,Q as F,g as Z,k as G,x as J,t as c,A as K,C,a as A,b as D,c as P,I as v,S as y,B as S,e as X,q as ee,y as se}from"./index-CVOPyXAZ.js";import{L as N}from"./label-Bsjya-7d.js";import"./vendor-charts-msDMqvam.js";import"./vendor-supabase-Djqvfl2V.js";import"./vendor-motion-D4ajpNSI.js";function te({...s}){return e.jsx(E,{"data-slot":"alert-dialog",...s})}function ae({...s}){return e.jsx(I,{"data-slot":"alert-dialog-trigger",...s})}function re({...s}){return e.jsx(U,{"data-slot":"alert-dialog-portal",...s})}function de({className:s,...t}){return e.jsx(q,{"data-slot":"alert-dialog-overlay",className:n("data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 fixed inset-0 z-50 bg-black/50",s),...t})}function ne({className:s,...t}){return e.jsxs(re,{children:[e.jsx(de,{}),e.jsx(R,{"data-slot":"alert-dialog-content",className:n("bg-background data-[state=open]:animate-in data-[state=closed]:animate-out data-[state=closed]:fade-out-0 data-[state=open]:fade-in-0 data-[state=closed]:zoom-out-95 data-[state=open]:zoom-in-95 fixed top-[50%] left-[50%] z-50 grid w-full max-w-[calc(100%-2rem)] translate-x-[-50%] translate-y-[-50%] gap-4 rounded-lg border p-6 shadow-lg duration-200 sm:max-w-lg",s),...t})]})}function ie({className:s,...t}){return e.jsx("div",{"data-slot":"alert-dialog-header",className:n("flex flex-col gap-2 text-center sm:text-left",s),...t,"data-source":"src/components/ui/alert-dialog.tsx:69:5"})}function le({className:s,...t}){return e.jsx("div",{"data-slot":"alert-dialog-footer",className:n("flex flex-col-reverse gap-2 sm:flex-row sm:justify-end",s),...t,"data-source":"src/components/ui/alert-dialog.tsx:82:5"})}function oe({className:s,...t}){return e.jsx(B,{"data-slot":"alert-dialog-title",className:n("text-lg font-semibold",s),...t})}function ce({className:s,...t}){return e.jsx(H,{"data-slot":"alert-dialog-description",className:n("text-muted-foreground text-sm",s),...t})}function ge({className:s,...t}){return e.jsx(L,{className:n(F(),s),...t})}function ue({className:s,...t}){return e.jsx(O,{className:n(F({variant:"outline"}),s),...t})}function xe({className:s,...t}){return e.jsx(M,{"data-slot":"switch",className:n("peer data-[state=checked]:bg-primary data-[state=unchecked]:bg-input focus-visible:border-ring focus-visible:ring-ring/50 dark:data-[state=unchecked]:bg-input/80 inline-flex h-[1.15rem] w-8 shrink-0 items-center rounded-full border border-transparent shadow-xs transition-all outline-none focus-visible:ring-[3px] disabled:cursor-not-allowed disabled:opacity-50",s),...t,children:e.jsx(Q,{"data-slot":"switch-thumb",className:n("bg-background dark:data-[state=unchecked]:bg-foreground dark:data-[state=checked]:bg-primary-foreground pointer-events-none block size-4 rounded-full ring-0 transition-transform data-[state=checked]:translate-x-[calc(100%-2px)] data-[state=unchecked]:translate-x-0")})})}const _="dark:bg-white/10 dark:backdrop-blur-md dark:border-white/10";function me(s,t){const r=window.open("","_blank","noopener,noreferrer");if(!r){c.error("تعذر فتح نافذة جديدة لإنشاء PDF");return}const d=`
  <!doctype html>
  <html lang="ar" dir="rtl">
    <head>
      <meta charset="UTF-8" />
      <meta name="viewport" content="width=device-width, initial-scale=1.0" />
      <title>${s}</title>
      <style>
        body { font-family: "Almarai", Arial, sans-serif; padding: 24px; }
        h1,h2,h3 { font-family: "Changa", Arial, sans-serif; margin: 0 0 12px; }
        .muted { color: #555; }
        .card { border: 1px solid #ddd; border-radius: 12px; padding: 16px; margin: 12px 0; }
        table { width: 100%; border-collapse: collapse; margin-top: 8px; }
        th, td { border: 1px solid #ddd; padding: 10px; text-align: right; }
        th { background: #f4f4f4; }
        @media print { a { display: none; } }
      </style>
      <link rel="preconnect" href="https://fonts.googleapis.com" />
      <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
      <link href="https://fonts.googleapis.com/css2?family=Almarai:wght@300;400;700;800&family=Changa:wght@400;600;700;800&display=swap" rel="stylesheet" />
    </head>
    <body>
      ${t}
      <script>
        setTimeout(() => { window.print(); }, 200);
      <\/script>
    </body>
  </html>`;r.document.open(),r.document.write(d),r.document.close()}function pe(s){const t=(s||"").trim();if(!t)return{university:"",major:""};const r=["|","—","-","•"];for(const d of r)if(t.includes(d)){const[x,u]=t.split(d);return{university:(x||"").trim(),major:(u||"").trim()}}return{university:t,major:""}}function he(s,t){const r=(s||"").trim(),d=(t||"").trim();return r&&d?`${r} | ${d}`:r||d||""}function Ne(){const s=Z(),t=X(),[r,d]=l.useState(!0),[x,u]=l.useState(!1),[m,p]=l.useState(""),[h,f]=l.useState(""),[j,b]=l.useState(""),[w,k]=l.useState(!0);l.useEffect(()=>{if(!s){p("مستخدم"),f(""),b(""),d(!1);return}(async()=>{try{d(!0);const a=await G(s);p(a.display_name||s.name||"مستخدم");const i=pe(a.study_title||"");f(i.university||""),b(i.major||"");const o=await J(s);k(typeof o.ads_enabled=="boolean"?!!o.ads_enabled:!0)}catch(a){console.error(a),c.error("تعذر تحميل بيانات الإعدادات")}finally{d(!1)}})()},[s?.id]);const T=async()=>{if(!s){c.error("سجّل دخولك أولاً لحفظ الإعدادات بشكل دائم");return}u(!0);try{await ee(s,{display_name:m.trim()||s.name||"مستخدم",study_title:he(h,j)}),await se(s,{ads_enabled:w}),c.success("تم حفظ بياناتك بشكل دائم")}catch(a){console.error(a),c.error("تعذر حفظ البيانات")}finally{u(!1)}},$=()=>{const a=[];for(let i=0;i<sessionStorage.length;i++){const o=sessionStorage.key(i);o&&o.startsWith("aass:")&&a.push(o)}a.forEach(i=>sessionStorage.removeItem(i)),c.success("تم مسح السجل بنجاح")},z=()=>{const a=sessionStorage.getItem("aass:last_uploaded_file_name")||"(لا يوجد)",i=`
      <h1>تقرير الأداء الشامل</h1>
      <div class="muted">Academic AI Study System — v1.0</div>

      <div class="card">
        <h2>الملف الشخصي</h2>
        <div>الاسم: <b>${m||"(غير محدد)"}</b></div>
        <div>الجامعة: <b>${h||"(غير محدد)"}</b></div>
        <div>التخصص: <b>${j||"(غير محدد)"}</b></div>
      </div>

      <div class="card">
        <h2>ملخص النشاط (نسخة أولية)</h2>
        <table>
          <thead>
            <tr><th>البند</th><th>القيمة</th></tr>
          </thead>
          <tbody>
            <tr><td>آخر ملف تم رفعه</td><td>${a}</td></tr>
            <tr><td>إجمالي ساعات المذاكرة</td><td>—</td></tr>
            <tr><td>متوسط الاختبارات</td><td>—</td></tr>
            <tr><td>عدد الملفات المعالجة</td><td>—</td></tr>
          </tbody>
        </table>
        <p class="muted">ملاحظة: سيتم ربط التقرير لاحقاً بإحصائيات Stats الحقيقية.</p>
      </div>
    `;me("تقرير الأداء الشامل",i)},g=r||x;return e.jsx(K,{children:e.jsxs("section",{className:"mx-auto w-full max-w-5xl space-y-6","data-source":"src/pages/Settings.tsx:215:7",children:[e.jsxs("div",{className:"space-y-2","data-source":"src/pages/Settings.tsx:216:9",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold","data-source":"src/pages/Settings.tsx:217:11",children:"الإعدادات والملف الشخصي"}),e.jsx("p",{className:"text-muted-foreground leading-7","data-source":"src/pages/Settings.tsx:218:11",children:"عدّل بياناتك، وأدر سجلك، وحمّل تقرير أداء شامل (PDF عبر الطباعة)."})]}),e.jsxs("div",{className:"grid gap-5 lg:grid-cols-2","data-source":"src/pages/Settings.tsx:223:9",children:[e.jsxs(C,{className:n(_),children:[e.jsx(A,{className:"pb-3",children:e.jsx(D,{className:"text-xl",children:"الملف الشخصي"})}),e.jsxs(P,{className:"space-y-4",children:[!s&&e.jsxs("div",{className:"rounded-xl border bg-secondary/20 p-4 text-sm leading-7","data-source":"src/pages/Settings.tsx:231:17",children:[e.jsx("div",{className:"font-extrabold","data-source":"src/pages/Settings.tsx:232:19",children:"ملحوظة"}),e.jsx("div",{className:"text-muted-foreground mt-1","data-source":"src/pages/Settings.tsx:233:19",children:"لحفظ بياناتك بشكل دائم في قاعدة البيانات، لازم تسجل دخولك أولاً."})]}),e.jsxs("div",{className:"grid gap-2","data-source":"src/pages/Settings.tsx:239:15",children:[e.jsx(N,{htmlFor:"name",children:"اسم الطالب"}),e.jsx(v,{id:"name",value:m,onChange:a=>p(a.target.value),disabled:g})]}),e.jsxs("div",{className:"grid gap-2","data-source":"src/pages/Settings.tsx:249:15",children:[e.jsx(N,{htmlFor:"uni",children:"الجامعة"}),e.jsx(v,{id:"uni",value:h,onChange:a=>f(a.target.value),disabled:g})]}),e.jsxs("div",{className:"grid gap-2","data-source":"src/pages/Settings.tsx:259:15",children:[e.jsx(N,{htmlFor:"major",children:"التخصص الدراسي"}),e.jsx(v,{id:"major",value:j,onChange:a=>b(a.target.value),disabled:g})]}),e.jsx(y,{}),e.jsx("div",{className:"rounded-xl border bg-secondary/20 p-4","data-source":"src/pages/Settings.tsx:271:15",children:e.jsxs("div",{className:"flex items-center justify-between gap-3","data-source":"src/pages/Settings.tsx:272:17",children:[e.jsxs("div",{"data-source":"src/pages/Settings.tsx:273:19",children:[e.jsx("div",{className:"font-extrabold","data-source":"src/pages/Settings.tsx:274:21",children:"الإعلانات"}),e.jsx("div",{className:"text-xs text-muted-foreground leading-6 mt-1","data-source":"src/pages/Settings.tsx:275:21",children:'عند إيقافها، سيتم إخفاء مساحات الإعلانات (Placeholder) — لاستخدام باقة "بدون إعلانات" لاحقاً.'})]}),e.jsx(xe,{checked:w,onCheckedChange:a=>k(!!a),disabled:g,"aria-label":"إظهار الإعلانات"})]})}),e.jsx(y,{}),e.jsxs("div",{className:"rounded-xl border bg-secondary/20 p-4","data-source":"src/pages/Settings.tsx:290:15",children:[e.jsx("div",{className:"font-extrabold","data-source":"src/pages/Settings.tsx:291:17",children:"Supabase Profiles"}),e.jsxs("div",{className:"text-xs text-muted-foreground leading-6 mt-1","data-source":"src/pages/Settings.tsx:292:17",children:["يتم حفظ: ",e.jsx("b",{"data-source":"src/pages/Settings.tsx:293:28",children:"الاسم"})," في ",e.jsx("code",{"data-source":"src/pages/Settings.tsx:293:44",children:"display_name"}),"، ويتم حفظ الجامعة+التخصص داخل",e.jsx("code",{"data-source":"src/pages/Settings.tsx:294:19",children:"study_title"})," بصيغة: ",e.jsx("b",{"data-source":"src/pages/Settings.tsx:294:51",children:"جامعة | تخصص"}),"."]})]}),e.jsx(y,{}),e.jsxs("div",{className:"flex flex-wrap gap-2","data-source":"src/pages/Settings.tsx:300:15",children:[e.jsxs(S,{className:"gap-2",onClick:T,disabled:!s||g,children:[e.jsx(V,{className:"size-4"}),"حفظ التغييرات"]}),!t&&e.jsx("div",{className:"text-xs text-muted-foreground leading-6","data-source":"src/pages/Settings.tsx:307:19",children:"Supabase غير مُفعّل في البيئة — سيتم الحفظ محلياً فقط (كاش)."})]})]})]}),e.jsxs(C,{className:n(_),children:[e.jsx(A,{className:"pb-3",children:e.jsx(D,{className:"text-xl",children:"إدارة البيانات"})}),e.jsxs(P,{className:"space-y-4",children:[e.jsxs("div",{className:"rounded-xl border bg-secondary/30 p-4","data-source":"src/pages/Settings.tsx:321:15",children:[e.jsx("div",{className:"font-extrabold","data-source":"src/pages/Settings.tsx:322:17",children:"تنبيه"}),e.jsx("div",{className:"text-sm text-muted-foreground leading-7 mt-1","data-source":"src/pages/Settings.tsx:323:17",children:"مسح السجل سيحذف بيانات الجلسة الحالية (الملف الأخير، نتائج الاختبارات المحاكية، وغيرها)."})]}),e.jsxs("div",{className:"flex flex-wrap gap-2","data-source":"src/pages/Settings.tsx:328:15",children:[e.jsxs(te,{children:[e.jsx(ae,{asChild:!0,children:e.jsxs(S,{variant:"destructive",className:"gap-2",children:[e.jsx(W,{className:"size-4"}),"مسح السجل"]})}),e.jsxs(ne,{children:[e.jsxs(ie,{children:[e.jsx(oe,{children:"تأكيد مسح السجل"}),e.jsx(ce,{children:"هل أنت متأكد؟ لا يمكن التراجع عن هذه العملية."})]}),e.jsxs(le,{children:[e.jsx(ue,{children:"إلغاء"}),e.jsx(ge,{onClick:$,children:"نعم، امسح"})]})]})]}),e.jsxs(S,{variant:"outline",className:"gap-2",onClick:z,children:[e.jsx(Y,{className:"size-4"}),"تحميل تقرير الأداء الشامل (PDF)"]})]}),e.jsx("div",{className:"text-xs text-muted-foreground leading-6","data-source":"src/pages/Settings.tsx:356:15",children:"ملاحظة: تنزيل PDF يتم عبر نافذة الطباعة (اختر Save as PDF)."})]})]})]})]})})}export{Ne as default};
