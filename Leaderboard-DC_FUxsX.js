import{r as i,j as e,t as v,T as g,u as j}from"./vendor-ui-ARy-o6ek.js";import{g as _,e as l,i as N,l as y,A as L,C as w,a as S,b as C,c as k,d as f,n as A,o as E,p as P,S as I}from"./index-CVOPyXAZ.js";import"./vendor-charts-msDMqvam.js";import"./vendor-supabase-Djqvfl2V.js";import"./vendor-motion-D4ajpNSI.js";const U="dark:bg-white/10 dark:backdrop-blur-md dark:border-white/10";function T(s){return s===1?v:s===2?g:s===3?j:g}function H(){const s=_(),[o,u]=i.useState([]),[x,m]=i.useState(!1),[p,h]=i.useState({});return i.useEffect(()=>{if(!l())return;const r=N();if(!r)return;let a=!0;return m(!0),(async()=>{try{const{data:d,error:c}=await r.from("leaderboard_public").select("user_id,xp,current_level,display_name,avatar_path").order("xp",{ascending:!1}).limit(25);if(c)throw c;const n=(d||[]).map(t=>({user_id:String(t.user_id),xp:Number(t.xp||0),current_level:Number(t.current_level||1),display_name:String(t.display_name||""),avatar_path:t.avatar_path?String(t.avatar_path):null}));if(!a)return;u(n)}catch{if(!a)return;u([])}finally{a&&m(!1)}})(),()=>{a=!1}},[s?.id]),i.useEffect(()=>{if(!s||!l())return;const r=o.filter(a=>a.avatar_path&&!p[a.user_id]);r.length&&(async()=>{const a={};for(const d of r.slice(0,10))try{const c=await y({user:s,avatarPath:String(d.avatar_path),expiresInSec:600});a[d.user_id]=c}catch{}Object.keys(a).length&&h(d=>({...d,...a}))})()},[o,s?.id]),e.jsx(L,{children:e.jsxs("section",{className:"mx-auto w-full max-w-4xl space-y-6","data-source":"src/pages/Leaderboard.tsx:105:7",children:[e.jsxs("div",{className:"space-y-2","data-source":"src/pages/Leaderboard.tsx:106:9",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold","data-source":"src/pages/Leaderboard.tsx:107:11",children:"لوحة الشرف"}),e.jsx("p",{className:"text-muted-foreground leading-7","data-source":"src/pages/Leaderboard.tsx:108:11",children:"ترتيب المستخدمين حسب XP (بيانات سحابية مباشرة)."})]}),e.jsxs(w,{className:f(U),children:[e.jsx(S,{className:"pb-3",children:e.jsx(C,{className:"text-xl",children:"أفضل 25 طالب"})}),e.jsxs(k,{className:"space-y-3",children:[!l()&&e.jsx("div",{className:"text-sm text-muted-foreground","data-source":"src/pages/Leaderboard.tsx:119:15",children:"فعّل السحابة أولاً."}),l()&&x&&e.jsx("div",{className:"text-sm text-muted-foreground","data-source":"src/pages/Leaderboard.tsx:123:15",children:"جاري تحميل الترتيب..."}),l()&&!x&&o.length===0&&e.jsx("div",{className:"text-sm text-muted-foreground","data-source":"src/pages/Leaderboard.tsx:127:15",children:"لا توجد بيانات بعد."}),o.map((r,a)=>{const d=a+1,c=T(d),n=s?.id&&r.user_id===s.id,t=r.display_name||(n?s?.name:"طالب"),b=p[r.user_id]||(n?s?.avatarUrl:"");return e.jsx("div",{className:"rounded-2xl border bg-background/60 dark:bg-white/5 dark:border-white/10","data-source":"src/pages/Leaderboard.tsx:138:17",children:e.jsx("div",{className:"p-4 flex items-center justify-between gap-3","data-source":"src/pages/Leaderboard.tsx:139:19",children:e.jsxs("div",{className:"flex items-center gap-3 min-w-0","data-source":"src/pages/Leaderboard.tsx:140:21",children:[e.jsx("div",{className:f("size-10 rounded-xl grid place-items-center",n?"bg-primary text-primary-foreground":"bg-secondary"),"data-source":"src/pages/Leaderboard.tsx:141:23",children:e.jsx(c,{className:"size-5"})}),e.jsxs(A,{children:[e.jsx(E,{src:b,alt:t}),e.jsx(P,{children:t.slice(0,1)})]}),e.jsxs("div",{className:"min-w-0","data-source":"src/pages/Leaderboard.tsx:151:23",children:[e.jsxs("div",{className:"font-extrabold truncate","data-source":"src/pages/Leaderboard.tsx:152:25",children:["#",d," — ",t,n?" (أنت)":""]}),e.jsxs("div",{className:"text-xs text-muted-foreground mt-1","data-source":"src/pages/Leaderboard.tsx:156:25",children:["Level ",r.current_level," • XP ",r.xp]})]})]})})},r.user_id)}),e.jsx(I,{}),e.jsx("div",{className:"text-xs text-muted-foreground leading-6","data-source":"src/pages/Leaderboard.tsx:167:13",children:"ملاحظة: لا يمكن ضمان ظهورك بالمركز الأول إلا إذا كانت XP الخاصة بك فعلاً الأعلى في قاعدة البيانات."})]})]})]})})}export{H as default};
