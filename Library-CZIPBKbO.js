import{r as h,j as e,F as w,C,B as v,e as k,D as A}from"./vendor-ui-ARy-o6ek.js";import{u as B,g as n,e as b,i as z,r as j,A as F,C as m,c as x,B as c,d as u,a as S,b as I,j as P}from"./index-CVOPyXAZ.js";import{S as p}from"./skeleton-I8iu4Y_S.js";import{p as L}from"./dashboard-metrics-C1xi88gJ.js";import{A as D}from"./AdUnit-DLxwGZFG.js";import"./vendor-charts-msDMqvam.js";import"./vendor-supabase-Djqvfl2V.js";import"./vendor-motion-D4ajpNSI.js";const f="dark:bg-white/10 dark:backdrop-blur-md dark:border-white/10";function E(r){try{return new Date(r).toLocaleString("ar-EG",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return r}}function $(r){if(!r||r<=0)return"0 B";const i=r/1024;if(i<1024)return`${i.toFixed(1)} KB`;const t=i/1024;return t<1024?`${t.toFixed(2)} MB`:`${(t/1024).toFixed(2)} GB`}function M(){const[,r]=B(),[i,t]=h.useState(!0),[g,l]=h.useState([]);h.useEffect(()=>{t(!0);const s=setTimeout(()=>{const a=n();if(!a){l([]),t(!1);return}if(b()){const o=z();if(!o){l(j(a.id)),t(!1);return}(async()=>{try{const{data:_,error:y}=await o.from("files").select("id,name,created_at,pdf_path,file_size_bytes").eq("user_id",a.id).order("created_at",{ascending:!1}).limit(500);if(y)throw y;l((_||[]).map(d=>({id:String(d.id),fileName:String(d.name),uploadedAt:String(d.created_at||new Date().toISOString()),pdfPath:String(d.pdf_path||""),fileSizeBytes:Number(d.file_size_bytes||0),hasAnalysis:!1})))}catch{l(j(a.id))}finally{t(!1)}})();return}l(j(a.id)),t(!1)},650);return()=>clearTimeout(s)},[]);const N=n();return e.jsx(F,{children:e.jsxs("section",{className:"mx-auto w-full max-w-6xl space-y-6","data-source":"src/pages/Library.tsx:110:7",children:[e.jsxs("div",{className:"space-y-2","data-source":"src/pages/Library.tsx:111:9",children:[e.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold","data-source":"src/pages/Library.tsx:112:11",children:"مكتبتي"}),e.jsx("p",{className:"text-muted-foreground leading-7","data-source":"src/pages/Library.tsx:113:11",children:"ملفاتك التي تم رفعها وتحليلها سابقاً — مع حفظ النتائج لتجنب إعادة استهلاك الـ API."})]}),!N&&e.jsx(m,{className:u(f),children:e.jsxs(x,{className:"pt-6 space-y-3",children:[e.jsx("div",{className:"font-extrabold","data-source":"src/pages/Library.tsx:121:15",children:"لا يوجد مستخدم مسجل حالياً"}),e.jsx("div",{className:"text-sm text-muted-foreground leading-7","data-source":"src/pages/Library.tsx:122:15",children:"سجّل الدخول/أنشئ حساباً لتفعيل المكتبة الدائمة ومزامنتها مع السحابة."}),e.jsxs("div",{className:"flex gap-2 flex-wrap","data-source":"src/pages/Library.tsx:125:15",children:[e.jsx(c,{onClick:()=>r("/auth"),children:"الذهاب لصفحة الحساب"}),e.jsx(c,{variant:"outline",onClick:()=>r("/رفع-المادة"),children:"رفع ملف الآن"})]})]})}),N&&e.jsxs("div",{className:"space-y-6","data-source":"src/pages/Library.tsx:136:11",children:[e.jsxs("div",{className:"grid gap-4 md:grid-cols-2","data-source":"src/pages/Library.tsx:137:11",children:[i&&e.jsx(e.Fragment,{children:Array.from({length:4}).map((s,a)=>e.jsxs(m,{className:u(f),children:[e.jsxs(S,{className:"pb-2",children:[e.jsx(p,{className:"h-6 w-3/4"}),e.jsx(p,{className:"h-4 w-1/2 mt-2"})]}),e.jsxs(x,{className:"space-y-3",children:[e.jsx(p,{className:"h-10 w-full"}),e.jsx(p,{className:"h-10 w-full"})]})]},a))}),!i&&g.length===0&&e.jsx(m,{className:u(f),children:e.jsxs(x,{className:"pt-6 space-y-3",children:[e.jsx("div",{className:"font-extrabold","data-source":"src/pages/Library.tsx:158:19",children:"مكتبتك فارغة"}),e.jsx("div",{className:"text-sm text-muted-foreground leading-7","data-source":"src/pages/Library.tsx:159:19",children:'ارفع ملفاً من صفحة "رفع الماتيريال" وسيظهر هنا بعد الاستخراج والتحليل.'}),e.jsx(c,{onClick:()=>r("/رفع-المادة"),children:"رفع الماتيريال"})]})}),!i&&g.map(s=>e.jsxs(m,{className:u(f),children:[e.jsxs(S,{className:"pb-2",children:[e.jsxs(I,{className:"text-xl flex items-start gap-2",children:[e.jsx(w,{className:"size-5 mt-0.5"}),e.jsx("span",{className:"leading-7","data-source":"src/pages/Library.tsx:173:23",children:s.fileName})]}),e.jsxs("div",{className:"text-xs text-muted-foreground flex flex-wrap items-center gap-2 mt-2","data-source":"src/pages/Library.tsx:175:21",children:[e.jsx(C,{className:"size-4"}),e.jsx("span",{"data-source":"src/pages/Library.tsx:177:23",children:E(s.uploadedAt)}),typeof s.extractedChars=="number"&&e.jsxs("span",{"data-source":"src/pages/Library.tsx:179:25",children:["• ",s.extractedChars.toLocaleString()," حرف"]}),typeof s.fileSizeBytes=="number"&&s.fileSizeBytes>0&&e.jsxs("span",{"data-source":"src/pages/Library.tsx:182:25",children:["• ",$(s.fileSizeBytes)]})]})]}),e.jsxs(x,{className:"flex flex-wrap gap-2",children:[e.jsxs(c,{className:"gap-2",onClick:()=>{sessionStorage.setItem("aass:active_file_id",s.id),sessionStorage.setItem("aass:last_uploaded_file_name",s.fileName);const a=n();a&&L(a.id,{id:s.id,fileName:s.fileName,uploadedAt:s.uploadedAt}),r(`/explain/${s.id}`)},children:[e.jsx(v,{className:"size-4"}),"مراجعة الشرح"]}),e.jsxs(c,{variant:"secondary",className:"gap-2",onClick:()=>{sessionStorage.setItem("aass:active_file_id",s.id),sessionStorage.setItem("aass:last_uploaded_file_name",s.fileName);const a=n();a&&L(a.id,{id:s.id,fileName:s.fileName,uploadedAt:s.uploadedAt}),r(`/بنك-الأسئلة/${s.id}`)},children:[e.jsx(k,{className:"size-4"}),"فتح الكويز"]}),b()&&s.pdfPath&&e.jsxs(c,{variant:"outline",className:"gap-2",onClick:async()=>{const a=n();if(a)try{const o=await P({user:a,pdfPath:s.pdfPath,expiresInSec:600});window.open(o,"_blank","noopener,noreferrer")}catch{}},children:[e.jsx(A,{className:"size-4"}),"تحميل PDF"]})]})]},s.id))]}),e.jsx(D,{slot:""})]})]})})}export{M as default};
