import{r as l,j as a,l as L,M as U,m as D,n as I}from"./vendor-ui-ARy-o6ek.js";import{u as M,g as $,k as G,l as P,m as q,t as c,A as H,C as b,c as w,B as S,a as K,b as O,n as R,o as J,p as Q,I as p,S as C,e as V,q as k,v as W}from"./index-CVOPyXAZ.js";import{L as f}from"./label-Bsjya-7d.js";import{m as X}from"./vendor-motion-D4ajpNSI.js";import"./vendor-charts-msDMqvam.js";import"./vendor-supabase-Djqvfl2V.js";const A="dark:bg-white/10 dark:backdrop-blur-md dark:border-white/10";function Y(r){try{return new Date(r).toLocaleString("ar-EG",{year:"numeric",month:"short",day:"2-digit",hour:"2-digit",minute:"2-digit"})}catch{return r}}function Z(r){if(!r||r<=0)return"0 B";const e=r/1024;if(e<1024)return`${e.toFixed(1)} KB`;const t=e/1024;return t<1024?`${t.toFixed(2)} MB`:`${(t/1024).toFixed(2)} GB`}function ia(){const[,r]=M(),e=$(),t=V(),[d,m]=l.useState(!0),[n,x]=l.useState(!1),[u,g]=l.useState(""),[h,j]=l.useState(""),[F,v]=l.useState(""),[N,y]=l.useState(""),[B,_]=l.useState(0);l.useEffect(()=>{if(!e){m(!1);return}(async()=>{try{m(!0);const s=await G(e);if(g(s.display_name||e.name||"مستخدم"),j(s.study_title||""),v(s.avatar_path||""),t&&s.avatar_path){const i=await P({user:e,avatarPath:s.avatar_path});y(i)}if(t){const i=await q(e,1e3);_(0)}}catch(s){console.error(s),c.error("تعذر تحميل البروفايل")}finally{m(!1)}})()},[e?.id]);const T=async()=>{if(e){x(!0);try{await k(e,{display_name:u.trim()||e.name||"مستخدم",study_title:h.trim(),avatar_path:F}),c.success("تم حفظ بياناتك")}catch(s){console.error(s),c.error("تعذر حفظ البيانات")}finally{x(!1)}}},z=async s=>{if(!e)return;const i=s.target.files?.[0];if(s.target.value="",!!i){if(!t){c.error("فعّل Supabase أولاً لرفع الصورة الشخصية");return}try{x(!0);const{path:o}=await W({user:e,file:i});v(o),await k(e,{avatar_path:o});const E=await P({user:e,avatarPath:o});y(E),c.success("تم تحديث الصورة الشخصية")}catch(o){console.error(o),c.error("فشل رفع الصورة")}finally{x(!1)}}};return a.jsx(H,{children:a.jsxs("section",{className:"mx-auto w-full max-w-4xl space-y-6","data-source":"src/pages/Profile.tsx:146:7",children:[a.jsxs("div",{className:"space-y-2","data-source":"src/pages/Profile.tsx:147:9",children:[a.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold","data-source":"src/pages/Profile.tsx:148:11",children:"الملف الشخصي"}),a.jsx("p",{className:"text-muted-foreground leading-7","data-source":"src/pages/Profile.tsx:149:11",children:"عدّل اسمك الدراسي وصورتك — وتابع استهلاكك للتخزين السحابي."})]}),!e&&a.jsx(b,{className:A,children:a.jsxs(w,{className:"pt-6 space-y-3",children:[a.jsx("div",{className:"font-extrabold","data-source":"src/pages/Profile.tsx:157:15",children:"سجّل دخولك أولاً"}),a.jsx("div",{className:"text-sm text-muted-foreground leading-7","data-source":"src/pages/Profile.tsx:158:15",children:"الملف الشخصي مرتبط بالحساب."}),a.jsx(S,{onClick:()=>r("/auth"),children:"الذهاب لصفحة الحساب"})]})}),e&&a.jsx(X.div,{initial:{opacity:0,y:10},animate:{opacity:1,y:0},children:a.jsxs(b,{className:A,children:[a.jsx(K,{className:"pb-3",children:a.jsxs(O,{className:"text-2xl flex items-center gap-2",children:[a.jsx(L,{className:"size-5"}),"بياناتي"]})}),a.jsxs(w,{className:"space-y-6",children:[a.jsxs("div",{className:"flex flex-col sm:flex-row items-start sm:items-center gap-4","data-source":"src/pages/Profile.tsx:176:17",children:[a.jsxs(R,{className:"size-20",children:[N?a.jsx(J,{src:N}):null,a.jsx(Q,{className:"text-xl font-extrabold",children:(u||e.name||"م").slice(0,1)})]}),a.jsxs("div",{className:"space-y-2","data-source":"src/pages/Profile.tsx:184:19",children:[a.jsxs("div",{className:"text-sm text-muted-foreground flex items-center gap-2","data-source":"src/pages/Profile.tsx:185:21",children:[a.jsx(U,{className:"size-4"})," ",e.email]}),a.jsxs("div",{className:"text-sm text-muted-foreground","data-source":"src/pages/Profile.tsx:188:21",children:["تاريخ الانضمام: ",Y(e.createdAt)]}),a.jsxs("div",{className:"flex items-center gap-2","data-source":"src/pages/Profile.tsx:192:21",children:[a.jsxs(f,{htmlFor:"avatar",className:"inline-flex items-center gap-2 text-sm font-semibold",children:[a.jsx(D,{className:"size-4"}),"صورة شخصية"]}),a.jsx(p,{id:"avatar",type:"file",accept:"image/png,image/jpeg,image/webp",className:"max-w-[260px]",onChange:z,disabled:!t||n})]}),!t&&a.jsx("div",{className:"text-xs text-muted-foreground","data-source":"src/pages/Profile.tsx:211:23",children:"لتفعيل الصورة الشخصية: اضبط مفاتيح Supabase في البيئة."})]})]}),a.jsx(C,{}),a.jsxs("div",{className:"grid gap-4 md:grid-cols-2","data-source":"src/pages/Profile.tsx:220:17",children:[a.jsxs("div",{className:"grid gap-2","data-source":"src/pages/Profile.tsx:221:19",children:[a.jsx(f,{htmlFor:"displayName",children:"الاسم المعروض"}),a.jsx(p,{id:"displayName",value:u,onChange:s=>g(s.target.value),placeholder:"مثال: عبدالرحمن",disabled:d||n})]}),a.jsxs("div",{className:"grid gap-2","data-source":"src/pages/Profile.tsx:232:19",children:[a.jsx(f,{htmlFor:"studyTitle",children:"اللقب الدراسي"}),a.jsx(p,{id:"studyTitle",value:h,onChange:s=>j(s.target.value),placeholder:"مثال: طالب حاسبات - سنة أولى",disabled:d||n})]})]}),a.jsx("div",{className:"flex flex-wrap items-center gap-2","data-source":"src/pages/Profile.tsx:244:17",children:a.jsxs(S,{className:"gap-2",onClick:T,disabled:n||d,children:[a.jsx(I,{className:"size-4"}),"حفظ"]})}),a.jsx(C,{}),a.jsxs("div",{className:"rounded-xl border p-4 dark:bg-white/10 dark:border-white/10","data-source":"src/pages/Profile.tsx:253:17",children:[a.jsx("div",{className:"font-extrabold","data-source":"src/pages/Profile.tsx:254:19",children:"استهلاك التخزين"}),a.jsx("div",{className:"text-sm text-muted-foreground mt-1","data-source":"src/pages/Profile.tsx:255:19",children:t?a.jsxs(a.Fragment,{children:["إجمالي ملفاتك (تقريبي): ",a.jsx("b",{"data-source":"src/pages/Profile.tsx:258:49",children:Z(B)})]}):"التخزين السحابي غير مفعل حالياً"})]})]})]})})]})})}export{ia as default};
