import{r as m,j as s,p as u,q as W,s as R,W as B}from"./vendor-ui-ARy-o6ek.js";import{g as q,w as T,A as G,S as K,C as j,a as b,b as S,c as v,B as x,t as e,e as h,i as g,x as A,y as _,z as y}from"./index-CVOPyXAZ.js";import{f as M}from"./confetti-D4xIRJ4C.js";import{m as Y}from"./vendor-motion-D4ajpNSI.js";import"./vendor-charts-msDMqvam.js";import"./vendor-supabase-Djqvfl2V.js";const f="dark:bg-white/10 dark:backdrop-blur-md dark:border-white/10",w=50,E=200,I=150,F=75;function as(){const a=q(),[L,O]=m.useState(()=>T()),[i,l]=m.useState(!1);m.useEffect(()=>{const t=r=>O(r?.detail||T());return window.addEventListener("aass:stats_updated",t),()=>window.removeEventListener("aass:stats_updated",t)},[]);const d=Math.max(0,Number(L?.coins||0)),C=async t=>{if(!a){e.error("سجّل دخولك أولاً");return}if(!h()){e.error("فعّل السحابة أولاً (Supabase)");return}const r=g();if(!r){e.error("تعذر الاتصال بالسحابة");return}l(!0);try{const{data:o,error:c}=await r.functions.invoke("create-checkout-session",{body:{packageId:t}});if(c)throw c;const n=String(o?.url||"");if(!n){e.error("تعذر بدء عملية الدفع");return}e.message("جاري تحويلك لبوابة الدفع..."),window.location.href=n}catch(o){console.error(o),e.error("فشل بدء عملية الدفع")}finally{l(!1)}},P=async t=>{if(!a){e.error("سجّل دخولك أولاً");return}if(!h()){e.error("فعّل السحابة أولاً (Supabase)");return}if(d<(t==="neon"?E:I)){e.error("رصيد Coins غير كافي");return}const o=g();if(!o){e.error("تعذر الاتصال بالسحابة");return}l(!0);try{const{data:c,error:n}=await o.rpc("secure_purchase",{item_id_input:`theme:${t}`});if(n){String(n.message||"").includes("INSUFFICIENT")?e.error("رصيد Coins غير كافي"):e.error("فشلت عملية الشراء");return}await A(a),await _(a,{theme:t}),document.documentElement.classList.remove("theme-neon","theme-dark-pro"),t==="neon"&&document.documentElement.classList.add("theme-neon"),t==="dark-pro"&&document.documentElement.classList.add("theme-dark-pro"),await y(a),M();const p=Number(c?.coins_after??NaN);e.success(Number.isFinite(p)?`تم الشراء! رصيدك الآن: ${p} Coins`:"تم تفعيل الثيم بنجاح!")}catch(c){console.error(c),e.error("فشلت عملية الشراء")}finally{l(!1)}},U=async()=>{if(!a){e.error("سجّل دخولك أولاً");return}if(!h()){e.error("فعّل السحابة أولاً (Supabase)");return}if(d<F){e.error("رصيد Coins غير كافي");return}const t=g();if(!t){e.error("تعذر الاتصال بالسحابة");return}l(!0);try{const{data:r,error:o}=await t.rpc("secure_purchase",{item_id_input:"golden_ticket:+5_questions"});if(o){String(o.message||"").includes("INSUFFICIENT")?e.error("رصيد Coins غير كافي"):e.error("فشلت عملية الشراء");return}const c=Number(r?.golden_tickets??NaN);if(Number.isFinite(c))await _(a,{golden_tickets:c});else{const p=await A(a);await _(a,{golden_tickets:Number(p.golden_tickets||0)+1})}await y(a);const n=Number(r?.coins_after??NaN);e.success(Number.isFinite(n)?`تم شراء التذكرة الذهبية! رصيدك الآن: ${n} Coins`:"تم شراء تذكرة ذهبية: +5 أسئلة في تحليل واحد")}catch(r){console.error(r),e.error("فشلت عملية الشراء")}finally{l(!1)}},[N,$]=m.useState(!1),[z,k]=m.useState(0),D=async()=>{if(!a){e.error("سجّل دخولك أولاً");return}if(!h()){e.error("فعّل السحابة أولاً (Supabase)");return}const t=g();if(!t){e.error("تعذر الاتصال بالسحابة");return}if(!N){$(!0),k(3),await new Promise(r=>{const o=window.setInterval(()=>{k(c=>{const n=c-1;return n<=0?(window.clearInterval(o),r(),0):n})},1e3)});try{const r=`ad_${a.id}_${Date.now()}_${Math.random().toString(16).slice(2)}`,{data:o,error:c}=await t.functions.invoke("reward-ad",{body:{adEventId:r,coinsReward:5}});if(c)throw c;await y(a);const n=Number(o?.coins_after??NaN);e.success(Number.isFinite(n)?`+5 Coins! رصيدك الآن: ${n}`:"+5 Coins تم منحها")}catch(r){console.error(r),e.error("فشل منح المكافأة")}finally{$(!1),k(0)}}},H=async()=>{if(!a){e.error("سجّل دخولك أولاً");return}if(!h()){e.error("فعّل السحابة أولاً (Supabase)");return}if(d<w){e.error("رصيد Coins غير كافي");return}const t=g();if(!t){e.error("تعذر الاتصال بالسحابة");return}l(!0);try{const{data:r,error:o}=await t.rpc("secure_purchase",{item_id_input:"pro_summary"});if(o){String(o.message||"").includes("INSUFFICIENT")?e.error("رصيد Coins غير كافي"):e.error("فشلت عملية الشراء");return}await y(a),M();const c=Number(r?.coins_after??NaN);e.success(Number.isFinite(c)?`تم الشراء! رصيدك الآن: ${c} Coins`:"تم شراء ميزة التلخيص الاحترافي بنجاح!")}catch(r){console.error(r),e.error("فشلت عملية الشراء")}finally{l(!1)}};return s.jsx(G,{children:s.jsxs("section",{className:"mx-auto w-full max-w-5xl space-y-6","data-source":"src/pages/Shop.tsx:307:7",children:[s.jsxs("div",{className:"flex flex-col gap-3 md:flex-row md:items-end md:justify-between","data-source":"src/pages/Shop.tsx:308:9",children:[s.jsxs("div",{className:"space-y-1","data-source":"src/pages/Shop.tsx:309:11",children:[s.jsx("h1",{className:"text-3xl md:text-4xl font-extrabold","data-source":"src/pages/Shop.tsx:310:13",children:"المتجر"}),s.jsx("p",{className:"text-muted-foreground leading-7","data-source":"src/pages/Shop.tsx:311:13",children:"استخدم Coins لفتح ميزات قوية داخل المنصة."})]}),s.jsxs(Y.div,{initial:{opacity:0,y:8},animate:{opacity:1,y:0},transition:{duration:.25,ease:"easeOut"},className:"inline-flex items-center gap-2 rounded-2xl border px-4 py-3 bg-muted/25 "+f,children:[s.jsx(u,{className:"size-5 text-yellow-500"}),s.jsxs("div",{className:"text-sm","data-source":"src/pages/Shop.tsx:326:13",children:[s.jsx("div",{className:"text-xs text-muted-foreground","data-source":"src/pages/Shop.tsx:327:15",children:"رصيدك الحالي"}),s.jsx("div",{className:"text-lg font-extrabold tabular-nums","data-source":"src/pages/Shop.tsx:328:15",children:d})]})]})]}),s.jsx(K,{}),s.jsxs("div",{className:"grid gap-4 md:grid-cols-2","data-source":"src/pages/Shop.tsx:335:9",children:[s.jsxs(j,{className:f,children:[s.jsxs(b,{className:"pb-3",children:[s.jsxs(S,{className:"text-xl flex items-center gap-2",children:[s.jsx(W,{className:"size-5 text-primary"}),"شحن الرصيد (Coins)"]}),s.jsx("div",{className:"text-xs text-muted-foreground leading-6","data-source":"src/pages/Shop.tsx:343:15",children:"شحن حقيقي عبر بوابة دفع (يتطلب تفعيل Stripe + Webhook على السيرفر)."})]}),s.jsxs(v,{className:"space-y-3",children:[s.jsxs("div",{className:"grid gap-2","data-source":"src/pages/Shop.tsx:348:15",children:[s.jsxs(x,{variant:"outline",className:"justify-between",disabled:i,onClick:()=>C("coins_200"),children:[s.jsx("span",{"data-source":"src/pages/Shop.tsx:355:19",children:"200 Coins"}),s.jsx("span",{className:"font-extrabold","data-source":"src/pages/Shop.tsx:356:19",children:"\\$1.99"})]}),s.jsxs(x,{variant:"outline",className:"justify-between",disabled:i,onClick:()=>C("coins_600"),children:[s.jsx("span",{"data-source":"src/pages/Shop.tsx:364:19",children:"600 Coins"}),s.jsx("span",{className:"font-extrabold","data-source":"src/pages/Shop.tsx:365:19",children:"\\$4.99"})]}),s.jsxs(x,{variant:"outline",className:"justify-between",disabled:i,onClick:()=>C("coins_1500"),children:[s.jsx("span",{"data-source":"src/pages/Shop.tsx:373:19",children:"1500 Coins"}),s.jsx("span",{className:"font-extrabold","data-source":"src/pages/Shop.tsx:374:19",children:"\\$9.99"})]})]}),s.jsxs("div",{className:"rounded-xl border bg-gradient-to-br from-secondary/35 to-background p-4 overflow-hidden relative","data-source":"src/pages/Shop.tsx:378:15",children:[s.jsx("div",{className:"absolute inset-0 opacity-60 pointer-events-none",style:{background:"radial-gradient(800px 220px at 10% 10%, color-mix(in oklch, var(--primary) 18%, transparent) 0%, transparent 55%), radial-gradient(800px 220px at 90% 30%, color-mix(in oklch, var(--primary) 10%, transparent) 0%, transparent 55%)"},"data-source":"src/pages/Shop.tsx:379:17"}),s.jsxs("div",{className:"relative","data-source":"src/pages/Shop.tsx:384:17",children:[s.jsx("div",{className:"font-extrabold","data-source":"src/pages/Shop.tsx:385:19",children:"احصل على 5 عملات مجاناً!"}),s.jsx("div",{className:"text-xs text-muted-foreground leading-6 mt-1","data-source":"src/pages/Shop.tsx:386:19",children:"شاهد إعلان (محاكاة) — وبعد انتهاء المشاهدة سيتم منح المكافأة **من السيرفر** لمنع أي تلاعب."}),N?s.jsxs("div",{className:"mt-3 rounded-lg border bg-background/70 p-3","data-source":"src/pages/Shop.tsx:391:21",children:[s.jsx("div",{className:"text-sm font-bold","data-source":"src/pages/Shop.tsx:392:23",children:"جاري تشغيل الإعلان…"}),s.jsxs("div",{className:"text-xs text-muted-foreground mt-1","data-source":"src/pages/Shop.tsx:393:23",children:["الوقت المتبقي: ",z," ث"]}),s.jsx("div",{className:"mt-2 h-2 w-full rounded-full bg-muted overflow-hidden","data-source":"src/pages/Shop.tsx:394:23",children:s.jsx("div",{className:"h-full bg-primary transition-all",style:{width:`${Math.max(0,Math.min(100,(3-z)/3*100))}%`},"data-source":"src/pages/Shop.tsx:395:25"})})]}):null,s.jsx(x,{className:"w-full mt-3",variant:"outline",onClick:D,disabled:N||i,children:N?"جاري منح المكافأة...":"شاهد واربح"})]})]}),s.jsx("div",{className:"text-xs text-muted-foreground leading-6","data-source":"src/pages/Shop.tsx:414:15",children:"بعد إتمام الدفع سيتم تحديث رصيدك تلقائياً خلال ثوانٍ عبر Webhook."})]})]}),s.jsxs(j,{className:f,children:[s.jsxs(b,{className:"pb-3",children:[s.jsxs(S,{className:"text-xl flex items-center gap-2",children:[s.jsx(R,{className:"size-5 text-primary"}),"ثيمات الموقع"]}),s.jsx("div",{className:"text-xs text-muted-foreground leading-6","data-source":"src/pages/Shop.tsx:426:15",children:"استبدل Coins لتغيير شكل المنصة فوراً."})]}),s.jsx(v,{className:"space-y-3",children:s.jsxs("div",{className:"grid gap-3","data-source":"src/pages/Shop.tsx:431:15",children:[s.jsxs("div",{className:"rounded-xl border p-4 bg-secondary/20","data-source":"src/pages/Shop.tsx:432:17",children:[s.jsxs("div",{className:"flex items-center justify-between","data-source":"src/pages/Shop.tsx:433:19",children:[s.jsxs("div",{"data-source":"src/pages/Shop.tsx:434:21",children:[s.jsx("div",{className:"font-extrabold","data-source":"src/pages/Shop.tsx:435:23",children:"Neon"}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1","data-source":"src/pages/Shop.tsx:436:23",children:"ألوان نيّون عالية التباين"})]}),s.jsxs("div",{className:"inline-flex items-center gap-1 font-extrabold","data-source":"src/pages/Shop.tsx:438:21",children:[s.jsx(u,{className:"size-4 text-yellow-500"}),s.jsx("span",{className:"tabular-nums","data-source":"src/pages/Shop.tsx:440:23",children:E})]})]}),s.jsx(x,{className:"w-full mt-3",onClick:()=>P("neon"),disabled:i||!a||d<E,children:"تفعيل Neon"})]}),s.jsxs("div",{className:"rounded-xl border p-4 bg-secondary/20","data-source":"src/pages/Shop.tsx:452:17",children:[s.jsxs("div",{className:"flex items-center justify-between","data-source":"src/pages/Shop.tsx:453:19",children:[s.jsxs("div",{"data-source":"src/pages/Shop.tsx:454:21",children:[s.jsx("div",{className:"font-extrabold","data-source":"src/pages/Shop.tsx:455:23",children:"Dark Pro"}),s.jsx("div",{className:"text-xs text-muted-foreground mt-1","data-source":"src/pages/Shop.tsx:456:23",children:"داكن أكثر عمقاً مع Accent سماوي"})]}),s.jsxs("div",{className:"inline-flex items-center gap-1 font-extrabold","data-source":"src/pages/Shop.tsx:458:21",children:[s.jsx(u,{className:"size-4 text-yellow-500"}),s.jsx("span",{className:"tabular-nums","data-source":"src/pages/Shop.tsx:460:23",children:I})]})]}),s.jsx(x,{className:"w-full mt-3",variant:"outline",onClick:()=>P("dark-pro"),disabled:i||!a||d<I,children:"تفعيل Dark Pro"})]})]})})]}),s.jsxs(j,{className:f,children:[s.jsxs(b,{className:"pb-3",children:[s.jsxs(S,{className:"text-xl flex items-center gap-2",children:[s.jsx(u,{className:"size-5 text-yellow-500"}),"التذاكر الذهبية"]}),s.jsx("div",{className:"text-xs text-muted-foreground leading-6","data-source":"src/pages/Shop.tsx:483:15",children:"كل تذكرة تُستخدم مرة واحدة وتزيد عدد أسئلة الذكاء الاصطناعي (+5) عند تحليل ملف جديد."})]}),s.jsxs(v,{className:"space-y-4",children:[s.jsxs("div",{className:"rounded-xl border p-4 bg-secondary/20","data-source":"src/pages/Shop.tsx:488:15",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3","data-source":"src/pages/Shop.tsx:489:17",children:[s.jsx("div",{className:"font-extrabold","data-source":"src/pages/Shop.tsx:490:19",children:"تذكرة واحدة"}),s.jsxs("div",{className:"inline-flex items-center gap-1 font-extrabold","data-source":"src/pages/Shop.tsx:491:19",children:[s.jsx(u,{className:"size-4 text-yellow-500"}),s.jsx("span",{className:"tabular-nums","data-source":"src/pages/Shop.tsx:493:21",children:F})]})]}),s.jsx("div",{className:"text-xs text-muted-foreground mt-2 leading-6","data-source":"src/pages/Shop.tsx:496:17",children:"سيتم استهلاك تذكرة تلقائياً عند اكتمال رفع وتحليل الملف."})]}),s.jsx(x,{className:"w-full",onClick:U,disabled:i||!a||d<F,children:"شراء تذكرة ذهبية"})]})]}),s.jsxs(j,{className:f,children:[s.jsxs(b,{className:"pb-3",children:[s.jsxs(S,{className:"text-xl flex items-center gap-2",children:[s.jsx(R,{className:"size-5 text-primary"}),"ميزة التلخيص الاحترافي"]}),s.jsx("div",{className:"text-xs text-muted-foreground leading-6","data-source":"src/pages/Shop.tsx:518:15",children:"تلخيص أكثر ترتيباً + نقاط عملية + أسئلة مراجعة مركزة."})]}),s.jsxs(v,{className:"space-y-4",children:[s.jsxs("div",{className:"rounded-xl border p-4 bg-secondary/20","data-source":"src/pages/Shop.tsx:523:15",children:[s.jsxs("div",{className:"flex items-center justify-between gap-3","data-source":"src/pages/Shop.tsx:524:17",children:[s.jsx("div",{className:"font-extrabold","data-source":"src/pages/Shop.tsx:525:19",children:"السعر"}),s.jsxs("div",{className:"inline-flex items-center gap-1 font-extrabold","data-source":"src/pages/Shop.tsx:526:19",children:[s.jsx(u,{className:"size-4 text-yellow-500"}),s.jsx("span",{className:"tabular-nums","data-source":"src/pages/Shop.tsx:528:21",children:w})]})]}),s.jsx("div",{className:"text-xs text-muted-foreground mt-2 leading-6","data-source":"src/pages/Shop.tsx:531:17",children:"بعد الشراء سيتم تفعيل الميزة على حسابك (الخطوة القادمة: ربطها بزر داخل صفحة الشرح)."})]}),s.jsxs(x,{className:"w-full gap-2",onClick:H,disabled:i||!a||d<w,children:[s.jsx(B,{className:"size-4"}),i?"جاري الشراء...":d<w?"Coins غير كافية":"شراء الآن"]}),!a&&s.jsx("div",{className:"text-xs text-muted-foreground","data-source":"src/pages/Shop.tsx:546:17",children:"سجّل دخولك لتظهر بيانات الرصيد وتعمل عمليات الشراء."})]})]})]})]})})}export{as as default};
